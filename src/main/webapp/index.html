

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/Styles/style.css" />
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <title>Formulario de registro e inicio de sesión</title>
</head>
<body>

    <!-- Formulario Registrarse -->
    <div class="container-form register hide">
        <div class="information">
            <h2>Bienvenido</h2>
            <p>Eres un miembro importante para nuestra comunidad.</p>
            <input type="button" value="Iniciar Sesión" id="sign-in" />
        </div>
        <div class="form-information">
            <h2>Crear una Cuenta</h2>
            <p class="datos">Ingresa tus datos</p>
            <form action="svtUsuarios" method="POST" class="form">
                <input type="hidden" name="action" value="registrar" />
                <input type="text" name="txtnombre" placeholder="Nombre" required />
                <input type="text" name="txtapellido" placeholder="Apellido" required />
                <input type="text" name="txttelefono" placeholder="Teléfono" required />
                <input type="password" name="txtcontrasena" placeholder="Contraseña" required />

                <!-- Combo Box para EPS -->
                <select name="id_eps" id="eps" onchange="loadIps(this.value)" required>
                    <option value="">Selecciona EPS</option>
                    <%
                    String url = "jdbc:mysql://localhost:3306/medical";
                    String user = "root";
                    String password = "";
                    Connection connection = null;
                    Statement statement = null;
                    ResultSet resultSet = null;

                    try {
                        Class.forName("com.mysql.cj.jdbc.Driver");
                        connection = DriverManager.getConnection(url, user, password);
                        statement = connection.createStatement();
                        String sql = "SELECT * FROM eps";
                        resultSet = statement.executeQuery(sql);

                        while (resultSet.next()) {
                            String nombre = resultSet.getString("nombre");
                            int id_eps = resultSet.getInt("id_eps");
            %>
                            <option value="<%= id_eps %>"><%= nombre %></option>
            <%
                        }
                    } catch (SQLException | ClassNotFoundException e) {
                        e.printStackTrace();
                    } finally {
                        try {
                            if (resultSet != null) resultSet.close();
                            if (statement != null) statement.close();
                            if (connection != null) connection.close();
                        } catch (SQLException e) {
                            e.printStackTrace();
                        }
                    }
            %>
                </select>

                <!-- Combo Box para IPS -->
                <select name="id_ips" id="ips" required>
                    <option value="">Selecciona IPS</option>
                </select>

                <input class="registrarse" type="submit" value="Registrarse" />
            </form>
        </div>
    </div>

    <!-- Formulario Iniciar Sesión -->
    <div class="container-form login">
        <div class="information">
            <h2>Bienvenido</h2>
            <p>Te invitamos a ser parte de nuestra comunidad.</p>
            <input type="button" value="Registrarse" id="sign-up" />
        </div>
        <div class="form-information">
            <h2>Iniciar Sesión</h2>
            <form action="srvUsuario" method="POST" class="form">
                <input type="hidden" name="accion" value="verificar" />
                <input type="text" name="nombre" placeholder="Nombre" required />
                <input type="password" name="contrasena" placeholder="Contraseña" required />
                <input class="registrarse" type="submit" value="Iniciar Sesión" />
            </form>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        function loadIps(epsId) {
            const ipsSelect = document.getElementById('ips');
            ipsSelect.innerHTML = '<option value="">Cargando...</option>'; // Muestra un mensaje de carga

            // Llamada a un servlet para cargar las IPS según la EPS seleccionada
            fetch(`loadIps?epsId=${epsId}`)
                .then(response => response.json())
                .then(data => {
                    ipsSelect.innerHTML = '<option value="">Selecciona IPS</option>';
                    data.forEach(ips => {
                        ipsSelect.innerHTML += `<option value="${ips.id_ips}">${ips.nombre}</option>`;
                    });
                })
                .catch(err => {
                    console.error(err);
                    ipsSelect.innerHTML = '<option value="">Error al cargar IPS</option>';
                });
        }
    </script>
</body>
</html>
